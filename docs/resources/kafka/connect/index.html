<!doctype html><html lang=en class=no-js>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=generator content="Hugo 0.88.1"><meta name=ROBOTS content="NOINDEX, NOFOLLOW">
<link rel="shortcut icon" href=/aiven-operator/favicons/favicon.ico>
<link rel=apple-touch-icon href=/aiven-operator/favicons/apple-touch-icon-180x180.png sizes=180x180>
<link rel=icon type=image/png href=/aiven-operator/favicons/favicon-16x16.png sizes=16x16>
<link rel=icon type=image/png href=/aiven-operator/favicons/favicon-32x32.png sizes=32x32>
<link rel=icon type=image/png href=/aiven-operator/favicons/android-36x36.png sizes=36x36>
<link rel=icon type=image/png href=/aiven-operator/favicons/android-48x48.png sizes=48x48>
<link rel=icon type=image/png href=/aiven-operator/favicons/android-72x72.png sizes=72x72>
<link rel=icon type=image/png href=/aiven-operator/favicons/android-96x96.png sizes=96x96>
<link rel=icon type=image/png href=/aiven-operator/favicons/android-144x144.png sizes=144x144>
<link rel=icon type=image/png href=/aiven-operator/favicons/android-192x192.png sizes=192x192>
<title>Kafka Connect | Aiven Operator</title>
<meta name=description content="Aiven Operator"><meta property="og:title" content="Kafka Connect">
<meta property="og:description" content="Aiven for Apache Kafka Connect is a framework and a runtime for integrating Kafka with other systems. Kafka connectors can either be a source (for pulling data from other systems into Kafka) or sink (for pushing data into other systems from Kafka).
This section involves a few different Kubernetes CRDs:
 A KafkaService service with a KafkaTopic A KafkaConnect service A ServiceIntegration to integrate the Kafka and KafkaConnect services A PostgreSQL used as a sink to receive messages from Kafka A KafkaConnector to finally connect the Kafka with the PostgreSQL  Creating the resources Create a file named kafka-sample-connect.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://aiven.github.io/aiven-operator/docs/resources/kafka/connect/"><meta property="article:section" content="docs">
<meta property="og:site_name" content="Aiven Operator">
<meta itemprop=name content="Kafka Connect">
<meta itemprop=description content="Aiven for Apache Kafka Connect is a framework and a runtime for integrating Kafka with other systems. Kafka connectors can either be a source (for pulling data from other systems into Kafka) or sink (for pushing data into other systems from Kafka).
This section involves a few different Kubernetes CRDs:
 A KafkaService service with a KafkaTopic A KafkaConnect service A ServiceIntegration to integrate the Kafka and KafkaConnect services A PostgreSQL used as a sink to receive messages from Kafka A KafkaConnector to finally connect the Kafka with the PostgreSQL  Creating the resources Create a file named kafka-sample-connect.">
<meta itemprop=wordCount content="1013">
<meta itemprop=keywords content><meta name=twitter:card content="summary">
<meta name=twitter:title content="Kafka Connect">
<meta name=twitter:description content="Aiven for Apache Kafka Connect is a framework and a runtime for integrating Kafka with other systems. Kafka connectors can either be a source (for pulling data from other systems into Kafka) or sink (for pushing data into other systems from Kafka).
This section involves a few different Kubernetes CRDs:
 A KafkaService service with a KafkaTopic A KafkaConnect service A ServiceIntegration to integrate the Kafka and KafkaConnect services A PostgreSQL used as a sink to receive messages from Kafka A KafkaConnector to finally connect the Kafka with the PostgreSQL  Creating the resources Create a file named kafka-sample-connect.">
<link rel=preload href=/aiven-operator/scss/main.min.0645ef8325971f852fa3823ea7990dfb6dd145515ff1f30281947d1317099f02.css as=style>
<link href=/aiven-operator/scss/main.min.0645ef8325971f852fa3823ea7990dfb6dd145515ff1f30281947d1317099f02.css rel=stylesheet integrity>
<script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script>
</head>
<body class=td-page>
<header>
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
<a class=navbar-brand href=/aiven-operator/>
<span class=navbar-logo><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 229.6 201.3" style="enable-background:new 0 0 229.6 201.3"><style>.st0{fill:url(#SVGID_1_)}.st1{fill:url(#SVGID_2_)}.st2{fill:url(#SVGID_3_)}.st3{fill:url(#SVGID_4_)}.st4{fill:url(#SVGID_5_)}.st5{fill:url(#SVGID_6_)}.st6{fill:url(#SVGID_7_)}.st7{fill:url(#SVGID_8_)}.st8{fill:url(#SVGID_9_)}</style><g><g><linearGradient id="SVGID_1_" gradientUnits="userSpaceOnUse" x1="82.3543" y1="154.7934" x2="153.6936" y2="58.3532"><stop offset="0" style="stop-color:#FF7700"/><stop offset=".7423" style="stop-color:#FF3554"/></linearGradient><path class="st0" d="M159.4 123.8c2.8.0 5.5.5 8 1.4 4-4.6 6.1-9.6 6.1-14.8.0-8.5-5.8-16.7-16.2-23.1-11.2-6.8-26.2-10.6-42.1-10.6h0c-16 0-31 3.8-42.1 10.6-10.5 6.4-16.2 14.6-16.2 23.1.0 5.2 2.1 10.2 6.1 14.8 2.5-.9 5.2-1.4 8-1.4 6.3.0 12.2 2.4 16.6 6.9 3.1 3.1 5.2 6.9 6.2 11.1 6.7 1.6 13.9 2.4 21.4 2.4 7.4.0 14.6-.8 21.4-2.4 1-4.1 3.1-8 6.2-11.1C147.2 126.2 153.1 123.8 159.4 123.8zm-44.2-19.6c-7.2.0-13.1-5.9-13.1-13.1h26.2C128.3 98.3 122.4 104.2 115.2 104.2z"/></g><g><linearGradient id="SVGID_2_" gradientUnits="userSpaceOnUse" x1="33.0471" y1="118.3196" x2="104.3864" y2="21.8794"><stop offset="0" style="stop-color:#FF7700"/><stop offset=".7423" style="stop-color:#FF3554"/></linearGradient><path class="st1" d="M69.9 81.1c1.3-.8 2.6-1.5 3.9-2.2h-.1c-3.3-2.5-7.2-3.7-11.1-3.7-5.6.0-11.1 2.5-14.7 7.3l-1.5 2.1 10.4 7.8C60 88.2 64.4 84.4 69.9 81.1z"/></g><g><linearGradient id="SVGID_3_" gradientUnits="userSpaceOnUse" x1="41.521" y1="124.588" x2="112.8603" y2="28.1478"><stop offset="0" style="stop-color:#FF7700"/><stop offset=".7423" style="stop-color:#FF3554"/></linearGradient><path class="st2" d="M56.9 128.5c-3.5-4.5-5.7-9.4-6.3-14.5-.2-1.2-.3-2.4-.3-3.6.0-6 2-11.7 5.7-16.9h-1.3c-10.2.0-18.4 8.3-18.4 18.4v2.6H50c-3.6 3-5.9 7.1-6.5 11.7-.7 4.9.6 9.7 3.6 13.6l1.1 1.5c1-4 3.1-7.6 6.1-10.6C55.2 129.8 56 129.1 56.9 128.5z"/></g><g><linearGradient id="SVGID_4_" gradientUnits="userSpaceOnUse" x1="104.3141" y1="171.0377" x2="175.6534" y2="74.5975"><stop offset="0" style="stop-color:#FF7700"/><stop offset=".7423" style="stop-color:#FF3554"/></linearGradient><path class="st3" d="M173.6 92.4l10.4-7.8-1.5-2.1c-3.6-4.8-9.1-7.3-14.7-7.3-3.9.0-7.7 1.2-11.1 3.7h-.1c1.3.7 2.7 1.4 3.9 2.2C166 84.4 170.4 88.2 173.6 92.4z"/></g><g><linearGradient id="SVGID_5_" gradientUnits="userSpaceOnUse" x1="126.4632" y1="187.4219" x2="197.8025" y2="90.9818"><stop offset="0" style="stop-color:#FF7700"/><stop offset=".7423" style="stop-color:#FF3554"/></linearGradient><path class="st4" d="M194.1 111.9c0-10.2-8.3-18.4-18.4-18.4h-1.3c3.8 5.2 5.7 11 5.7 16.9.0 1.2-.1 2.4-.3 3.6-.7 5.1-2.9 10-6.3 14.5.9.7 1.8 1.4 2.6 2.2 3 3 5.1 6.6 6.1 10.6l1.1-1.5c3-3.9 4.3-8.8 3.6-13.6-.6-4.6-2.9-8.8-6.5-11.7h13.7V111.9z"/></g><g><linearGradient id="SVGID_6_" gradientUnits="userSpaceOnUse" x1="41.092" y1="124.2706" x2="112.4313" y2="27.8304"><stop offset="0" style="stop-color:#FF7700"/><stop offset=".7423" style="stop-color:#FF3554"/></linearGradient><path class="st5" d="M93.1 72.4c10.2.0 18.4-8.3 18.4-18.4.0-10.2-8.3-18.4-18.4-18.4-10.2.0-18.4 8.3-18.4 18.4C74.6 64.2 82.9 72.4 93.1 72.4zm0-28.5c-1.2 1.3-2 3.1-2 5.1.0 3.9 3.2 7.1 7.1 7.1 2 0 3.8-.8 5.1-2.1v.1c0 5.6-4.5 10.1-10.1 10.1C87.5 64.1 83 59.6 83 54s4.5-10.1 10.1-10.1z"/></g><g><linearGradient id="SVGID_7_" gradientUnits="userSpaceOnUse" x1="69.7399" y1="145.4622" x2="141.0792" y2="49.022"><stop offset="0" style="stop-color:#FF7700"/><stop offset=".7423" style="stop-color:#FF3554"/></linearGradient><path class="st6" d="M137.4 72.4c10.2.0 18.4-8.3 18.4-18.4.0-10.2-8.3-18.4-18.4-18.4-10.2.0-18.4 8.3-18.4 18.4.0 10.2 8.2 18.4 18.4 18.4zm0-28.5c-1.2 1.3-2 3.1-2 5.1.0 3.9 3.2 7.1 7.1 7.1 2 0 3.8-.8 5.1-2.1v.1c0 5.6-4.5 10.1-10.1 10.1s-10.1-4.5-10.1-10.1C127.3 48.4 131.8 43.9 137.4 43.9z"/></g><g><linearGradient id="SVGID_8_" gradientUnits="userSpaceOnUse" x1="71.0978" y1="146.4667" x2="142.4371" y2="50.0265"><stop offset="0" style="stop-color:#FF7700"/><stop offset=".7423" style="stop-color:#FF3554"/></linearGradient><path class="st7" d="M71 128.9c-10.2.0-18.4 8.2-18.4 18.4.0 10.2 8.2 18.4 18.4 18.4 2.1.0 4.2-.4 6.1-1.1-.2-.2-.4-.3-.5-.5-5.3-5.3-7.2-12.2-4-15.3 3.1-3.1 10-1.3 15.3 4 .2.2.3.4.5.5.7-1.9 1.1-3.9 1.1-6.1C89.4 137.1 81.2 128.9 71 128.9z"/></g><g><linearGradient id="SVGID_9_" gradientUnits="userSpaceOnUse" x1="128.5964" y1="188.9998" x2="199.9357" y2="92.5597"><stop offset="0" style="stop-color:#FF7700"/><stop offset=".7423" style="stop-color:#FF3554"/></linearGradient><path class="st8" d="M159.5 128.9c-10.2.0-18.4 8.2-18.4 18.4.0 2.1.4 4.2 1.1 6.1.2-.2.3-.4.5-.5 5.3-5.3 12.2-7.2 15.3-4 3.1 3.1 1.3 10-4 15.3-.2.2-.3.3-.5.5 1.9.7 3.9 1.1 6.1 1.1 10.2.0 18.4-8.2 18.4-18.4C177.9 137.1 169.6 128.9 159.5 128.9z"/></g></g></svg></span><span class="text-uppercase font-weight-bold">Aiven Operator</span>
</a>
<div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar>
<ul class="navbar-nav mt-2 mt-lg-0">
</ul>
</div>
<div class="navbar-nav d-none d-lg-block">
</div>
</nav>
</header>
<div class="container-fluid td-outer">
<div class=td-main>
<div class="row flex-xl-nowrap">
<aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
<div id=td-sidebar-menu class=td-sidebar__inner>
<form class="td-sidebar__search d-flex align-items-center">
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation">
</button>
</form>
<nav class="collapse td-sidebar-nav" id=td-section-nav>
<ul class="td-sidebar-nav__section pr-md-3 ul-0">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-aiven-operator-li>
<a href=/aiven-operator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-aiven-operator><span></span></a>
<ul class=ul-1>
<li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-aiven-operatordocsinstallation-li>
<a href=/aiven-operator/docs/installation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-aiven-operatordocsinstallation><span>Installation</span></a>
<ul class="ul-2 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-aiven-operatordocsinstallationprerequisites-li>
<a href=/aiven-operator/docs/installation/prerequisites/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-aiven-operatordocsinstallationprerequisites><span>Prerequisites</span></a>
</li>
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-aiven-operatordocsinstallationhelm-li>
<a href=/aiven-operator/docs/installation/helm/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-aiven-operatordocsinstallationhelm><span>Installing with Helm (recommended)</span></a>
</li>
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-aiven-operatordocsinstallationkubectl-li>
<a href=/aiven-operator/docs/installation/kubectl/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-aiven-operatordocsinstallationkubectl><span>Installing with kubectl</span></a>
</li>
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-aiven-operatordocsinstallationuninstalling-li>
<a href=/aiven-operator/docs/installation/uninstalling/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-aiven-operatordocsinstallationuninstalling><span>Uninstalling</span></a>
</li>
</ul>
</li>
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-aiven-operatordocsauthentication-li>
<a href=/aiven-operator/docs/authentication/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-aiven-operatordocsauthentication><span>Authenticating</span></a>
</li>
<li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-aiven-operatordocsresources-li>
<a href=/aiven-operator/docs/resources/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-aiven-operatordocsresources><span>Resources</span></a>
<ul class="ul-2 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-aiven-operatordocsresourcesproject-li>
<a href=/aiven-operator/docs/resources/project/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-aiven-operatordocsresourcesproject><span>Aiven Project</span></a>
</li>
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-aiven-operatordocsresourcesproject-vpc-li>
<a href=/aiven-operator/docs/resources/project-vpc/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-aiven-operatordocsresourcesproject-vpc><span>Aiven Project VPC</span></a>
</li>
<li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-aiven-operatordocsresourceskafka-li>
<a href=/aiven-operator/docs/resources/kafka/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-aiven-operatordocsresourceskafka><span>Kafka</span></a>
<ul class="ul-3 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-aiven-operatordocsresourceskafkaschema-li>
<a href=/aiven-operator/docs/resources/kafka/schema/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-aiven-operatordocsresourceskafkaschema><span>Kafka Schema</span></a>
</li>
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-aiven-operatordocsresourceskafkaconnect-li>
<a href=/aiven-operator/docs/resources/kafka/connect/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-aiven-operatordocsresourceskafkaconnect><span class=td-sidebar-nav-active-item>Kafka Connect</span></a>
</li>
</ul>
</li>
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-aiven-operatordocsresourcespostgresql-li>
<a href=/aiven-operator/docs/resources/postgresql/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-aiven-operatordocsresourcespostgresql><span>PostgreSQL</span></a>
</li>
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-aiven-operatordocsresourcesservice-integrations-li>
<a href=/aiven-operator/docs/resources/service-integrations/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-aiven-operatordocsresourcesservice-integrations><span>Service Integrations</span></a>
</li>
</ul>
</li>
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-aiven-operatordocstroubleshooting-li>
<a href=/aiven-operator/docs/troubleshooting/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-aiven-operatordocstroubleshooting><span>Troubleshooting</span></a>
</li>
<li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-aiven-operatordocscontributing-li>
<a href=/aiven-operator/docs/contributing/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-aiven-operatordocscontributing><span>Contributing</span></a>
<ul class="ul-2 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-aiven-operatordocscontributingdeveloper-guide-li>
<a href=/aiven-operator/docs/contributing/developer-guide/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-aiven-operatordocscontributingdeveloper-guide><span>Developer guide</span></a>
</li>
</ul>
</li>
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-aiven-operatordocsapi-reference-li>
<a href=/aiven-operator/docs/api-reference/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-aiven-operatordocsapi-reference><span>API Reference</span></a>
</li>
</ul>
</li>
</ul>
</nav>
</div>
</aside>
<aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none">
<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">
</div>
<div class=td-toc><nav id=TableOfContents>
<ul>
<li><a href=#creating-the-resources>Creating the resources</a></li>
<li><a href=#testing>Testing</a></li>
<li><a href=#clean-up>Clean up</a></li>
</ul>
</nav></div>
</aside>
<main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main>
<div class=td-content>
<h1>Kafka Connect</h1>
<header class=article-meta>
</header>
<p><a href=https://aiven.io/kafka-connect>Aiven for Apache Kafka Connect</a> is a framework and a runtime for integrating Kafka with other systems. Kafka connectors can either be a source (for pulling data from other systems into Kafka) or sink (for pushing data into other systems from Kafka).</p>
<p>This section involves a few different Kubernetes CRDs:</p>
<ol>
<li>A <code>KafkaService</code> service with a <code>KafkaTopic</code></li>
<li>A <code>KafkaConnect</code> service</li>
<li>A <code>ServiceIntegration</code> to integrate the <code>Kafka</code> and <code>KafkaConnect</code> services</li>
<li>A <code>PostgreSQL</code> used as a sink to receive messages from <code>Kafka</code></li>
<li>A <code>KafkaConnector</code> to finally connect the <code>Kafka</code> with the <code>PostgreSQL</code></li>
</ol>
<h2 id=creating-the-resources>Creating the resources</h2>
<p>Create a file named <code>kafka-sample-connect.yaml</code> with the following content:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>aiven.io/v1alpha1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Kafka</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>kafka-sample-connect</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#75715e># gets the authentication token from the `aiven-token` Secret</span>
  <span style=color:#f92672>authSecretRef</span>:
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>aiven-token</span>
    <span style=color:#f92672>key</span>: <span style=color:#ae81ff>token</span>
  
  <span style=color:#75715e># outputs the Kafka connection on the `kafka-connection` Secret</span>
  <span style=color:#f92672>connInfoSecretTarget</span>:
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>kafka-auth</span>

  <span style=color:#75715e># add your Project name here</span>
  <span style=color:#f92672>project</span>: <span style=color:#ae81ff>&lt;your-project-name&gt;</span>

  <span style=color:#75715e># cloud provider and plan of your choice</span>
  <span style=color:#75715e># you can check all of the possibilities here https://aiven.io/pricing</span>
  <span style=color:#f92672>cloudName</span>: <span style=color:#ae81ff>google-europe-west1</span>
  <span style=color:#f92672>plan</span>: <span style=color:#ae81ff>business-4</span>

  <span style=color:#75715e># general Aiven configuration</span>
  <span style=color:#f92672>maintenanceWindowDow</span>: <span style=color:#ae81ff>friday</span>
  <span style=color:#f92672>maintenanceWindowTime</span>: <span style=color:#ae81ff>23</span>:<span style=color:#ae81ff>00</span>:<span style=color:#ae81ff>00</span>

  <span style=color:#75715e># specific Kafka configuration</span>
  <span style=color:#f92672>userConfig</span>:
    <span style=color:#f92672>kafka_version</span>: <span style=color:#e6db74>&#39;2.7&#39;</span>
    <span style=color:#f92672>kafka_connect</span>: <span style=color:#66d9ef>true</span>

---

<span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>aiven.io/v1alpha1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>KafkaTopic</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>kafka-topic-connect</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>authSecretRef</span>:
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>aiven-token</span>
    <span style=color:#f92672>key</span>: <span style=color:#ae81ff>token</span>

  <span style=color:#f92672>project</span>: <span style=color:#ae81ff>&lt;your-project-name&gt;</span>
  <span style=color:#f92672>serviceName</span>: <span style=color:#ae81ff>kafka-sample-connect</span>

  <span style=color:#f92672>replication</span>: <span style=color:#ae81ff>2</span>
  <span style=color:#f92672>partitions</span>: <span style=color:#ae81ff>1</span>
</code></pre></div><p>Next, create a file named <code>kafka-connect.yaml</code> and add the following <code>KafkaConnect</code> resource:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>aiven.io/v1alpha1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>KafkaConnect</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>kafka-connect</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#75715e># gets the authentication token from the `aiven-token` Secret</span>
  <span style=color:#f92672>authSecretRef</span>:
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>aiven-token</span>
    <span style=color:#f92672>key</span>: <span style=color:#ae81ff>token</span>

  <span style=color:#75715e># add your Project name here</span>
  <span style=color:#f92672>project</span>: <span style=color:#ae81ff>&lt;your-project-name&gt;</span>

  <span style=color:#75715e># cloud provider and plan of your choice</span>
  <span style=color:#75715e># you can check all of the possibilities here https://aiven.io/pricing</span>
  <span style=color:#f92672>cloudName</span>: <span style=color:#ae81ff>google-europe-west1</span>
  <span style=color:#f92672>plan</span>: <span style=color:#ae81ff>startup-4</span>

  <span style=color:#75715e># general Aiven configuration</span>
  <span style=color:#f92672>maintenanceWindowDow</span>: <span style=color:#ae81ff>friday</span>
  <span style=color:#f92672>maintenanceWindowTime</span>: <span style=color:#ae81ff>23</span>:<span style=color:#ae81ff>00</span>:<span style=color:#ae81ff>00</span>
</code></pre></div><p>Now let&rsquo;s create a <code>ServiceIntegration</code>. It will use the fields <code>sourceServiceName</code> and <code>destinationServiceName</code> to integrate the previously created <code>kafka-sample-connect</code> and <code>kafka-connect</code>. Open a new file named <code>service-integration-connect.yaml</code> and add the content below:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>aiven.io/v1alpha1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ServiceIntegration</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>service-integration-kafka-connect</span>
<span style=color:#f92672>spec</span>:

  <span style=color:#75715e># gets the authentication token from the `aiven-token` Secret</span>
  <span style=color:#f92672>authSecretRef</span>:
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>aiven-token</span>
    <span style=color:#f92672>key</span>: <span style=color:#ae81ff>token</span>

  <span style=color:#f92672>project</span>: <span style=color:#ae81ff>&lt;your-project-name&gt;</span>

  <span style=color:#75715e># indicates the type of the integration</span>
  <span style=color:#f92672>integrationType</span>: <span style=color:#ae81ff>kafka_connect</span>

  <span style=color:#75715e># we will send messages from the `kafka-sample-connect` to `kafka-connect`</span>
  <span style=color:#f92672>sourceServiceName</span>: <span style=color:#ae81ff>kafka-sample-connect</span>
  <span style=color:#f92672>destinationServiceName</span>: <span style=color:#ae81ff>kafka-connect</span>
</code></pre></div><p>Let&rsquo;s add an Aiven for PostgreSQL service. It will be the service used as a <em>sink</em>, receiving messages from the <code>kafka-sample-connect</code> cluster. Create a file named <code>pg-sample-connect.yaml</code> with the content below:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>aiven.io/v1alpha1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>PostgreSQL</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>pg-connect</span>
<span style=color:#f92672>spec</span>:

  <span style=color:#75715e># gets the authentication token from the `aiven-token` Secret</span>
  <span style=color:#f92672>authSecretRef</span>:
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>aiven-token</span>
    <span style=color:#f92672>key</span>: <span style=color:#ae81ff>token</span>

  <span style=color:#75715e># outputs the PostgreSQL connection on the `pg-connection` Secret</span>
  <span style=color:#f92672>connInfoSecretTarget</span>:
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>pg-connection</span>

  <span style=color:#75715e># add your Project name here</span>
  <span style=color:#f92672>project</span>: <span style=color:#ae81ff>&lt;your-project-name&gt;</span>

  <span style=color:#75715e># cloud provider and plan of your choice</span>
  <span style=color:#75715e># you can check all of the possibilities here https://aiven.io/pricing</span>
  <span style=color:#f92672>cloudName</span>: <span style=color:#ae81ff>google-europe-west1</span>
  <span style=color:#f92672>plan</span>: <span style=color:#ae81ff>startup-4</span>

  <span style=color:#75715e># general Aiven configuration</span>
  <span style=color:#f92672>maintenanceWindowDow</span>: <span style=color:#ae81ff>friday</span>
  <span style=color:#f92672>maintenanceWindowTime</span>: <span style=color:#ae81ff>23</span>:<span style=color:#ae81ff>00</span>:<span style=color:#ae81ff>00</span>
</code></pre></div><p>Finally, let&rsquo;s add the glue of everything: a <code>KafkaConnector</code>. As described in the specification, it will send receive messages from the <code>kafka-sample-connect</code> and send them to the <code>pg-connect</code> service. Check our <a href=https://help.aiven.io/en/articles/1231452-kafka-connect-connectors>official documentation</a> for more connectors.</p>
<p>Create a file named <code>kafka-connector-connect.yaml</code> and with the content below:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>aiven.io/v1alpha1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>KafkaConnector</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>kafka-connector</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>authSecretRef</span>:
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>aiven-token</span>
    <span style=color:#f92672>key</span>: <span style=color:#ae81ff>token</span>
<span style=color:#ae81ff>​</span>
  <span style=color:#f92672>project</span>: <span style=color:#ae81ff>&lt;your-project-name&gt;</span>
<span style=color:#ae81ff>​</span>
  <span style=color:#75715e># the Kafka cluster name</span>
  <span style=color:#f92672>serviceName</span>: <span style=color:#ae81ff>kafka-sample-connect</span>
<span style=color:#ae81ff>​</span>
  <span style=color:#75715e># the connector we will be using</span>
  <span style=color:#f92672>connectorClass</span>: <span style=color:#ae81ff>io.aiven.connect.jdbc.JdbcSinkConnector</span>

  <span style=color:#f92672>userConfig</span>:
    <span style=color:#f92672>auto.create</span>: <span style=color:#e6db74>&#34;true&#34;</span>

    <span style=color:#75715e># constructs the pg-connect connection information</span>
    <span style=color:#f92672>connection.url</span>: <span style=color:#e6db74>&#39;jdbc:postgresql://{{ fromSecret &#34;pg-connection&#34; &#34;PGHOST&#34;}}:{{ fromSecret &#34;pg-connection&#34; &#34;PGPORT&#34; }}/{{ fromSecret &#34;pg-connection&#34; &#34;PGDATABASE&#34; }}&#39;</span>
    <span style=color:#f92672>connection.user</span>: <span style=color:#e6db74>&#39;{{ fromSecret &#34;pg-connection&#34; &#34;PGUSER&#34; }}&#39;</span>
    <span style=color:#f92672>connection.password</span>: <span style=color:#e6db74>&#39;{{ fromSecret &#34;pg-connection&#34; &#34;PGPASSWORD&#34; }}&#39;</span>

    <span style=color:#75715e># specify which topics it will watch</span>
    <span style=color:#f92672>topics</span>: <span style=color:#ae81ff>kafka-topic-connect</span>

    <span style=color:#f92672>key.converter</span>: <span style=color:#ae81ff>org.apache.kafka.connect.json.JsonConverter</span>
    <span style=color:#f92672>value.converter</span>: <span style=color:#ae81ff>org.apache.kafka.connect.json.JsonConverter</span>
    <span style=color:#f92672>value.converter.schemas.enable</span>: <span style=color:#e6db74>&#34;true&#34;</span>
</code></pre></div><p>With all the files create, let&rsquo;s apply the new Kubernetes resources:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl apply <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  -f kafka-sample-connect.yaml <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  -f kafka-connect.yaml <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  -f service-integration-connect.yaml <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  -f pg-sample-connect.yaml <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  -f kafka-connector-connect.yaml
</code></pre></div><p>It will take some time for all the services to be up and running. You can check all of them with the command below. The deployment is finished when all services have the state <code>RUNNING</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl get <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    kafkas.aiven.io/kafka-sample-connect <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    kafkaconnects.aiven.io/kafka-connect <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    postgresqls.aiven.io/pg-connect <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>    kafkaconnectors.aiven.io/kafka-connector

NAME                                  PROJECT        REGION                PLAN         STATE
kafka.aiven.io/kafka-sample-connect   your-project   google-europe-west1   business-4   RUNNING

NAME                                  STATE
kafkaconnect.aiven.io/kafka-connect   RUNNING

NAME                             PROJECT        REGION                PLAN        STATE
postgresql.aiven.io/pg-connect   your-project   google-europe-west1   startup-4   RUNNING

NAME                                      SERVICE NAME           PROJECT        CONNECTOR CLASS                           STATE     TASKS TOTAL   TASKS RUNNING
kafkaconnector.aiven.io/kafka-connector   kafka-sample-connect   your-project   io.aiven.connect.jdbc.JdbcSinkConnector   RUNNING   <span style=color:#ae81ff>1</span>             <span style=color:#ae81ff>1</span>
</code></pre></div><h2 id=testing>Testing</h2>
<p>To test the connection integration, let&rsquo;s produce a Kafka message using <a href=https://github.com/edenhill/kcat>kcat</a> from within the Kubernetes cluster. We will deploy a Pod responsible for crafting a message and sending to the Kafka cluster, using the <code>kafka-auth</code> secret generate by the <code>Kafka</code> CRD.</p>
<p>Create a new file named <code>kcat-connect.yaml</code> and add the content below:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>kafka-message</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>containers</span>:

  <span style=color:#f92672>restartPolicy</span>: <span style=color:#ae81ff>Never</span>
    - <span style=color:#f92672>image</span>: <span style=color:#ae81ff>edenhill/kcat:1.7.0</span>
      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>kcat</span>

      <span style=color:#f92672>command</span>: [<span style=color:#e6db74>&#39;/bin/sh&#39;</span>]
      <span style=color:#f92672>args</span>: [
        <span style=color:#e6db74>&#39;-c&#39;</span>,
        <span style=color:#e6db74>&#39;echo {\&#34;schema\&#34;:{\&#34;type\&#34;:\&#34;struct\&#34;,\&#34;fields\&#34;:[{ \&#34;field\&#34;: \&#34;text\&#34;, \&#34;type\&#34;: \&#34;string\&#34;, \&#34;optional\&#34;: false } ] }, \&#34;payload\&#34;: { \&#34;text\&#34;: \&#34;Hello World\&#34; } } &gt; /tmp/msg;
</span><span style=color:#e6db74>
</span><span style=color:#e6db74>        kcat
</span><span style=color:#e6db74>          -b $(HOST):$(PORT)
</span><span style=color:#e6db74>          -X security.protocol=SSL
</span><span style=color:#e6db74>          -X ssl.key.location=/kafka-auth/ACCESS_KEY
</span><span style=color:#e6db74>          -X ssl.key.password=$(PASSWORD)
</span><span style=color:#e6db74>          -X ssl.certificate.location=/kafka-auth/ACCESS_CERT
</span><span style=color:#e6db74>          -X ssl.ca.location=/kafka-auth/CA_CERT
</span><span style=color:#e6db74>          -P -t kafka-topic-connect /tmp/msg&#39;</span>
      ]

      <span style=color:#f92672>envFrom</span>:
      - <span style=color:#f92672>secretRef</span>:
          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>kafka-auth</span>

      <span style=color:#f92672>volumeMounts</span>:
      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>kafka-auth</span>
        <span style=color:#f92672>mountPath</span>: <span style=color:#e6db74>&#34;/kafka-auth&#34;</span>

  <span style=color:#f92672>volumes</span>:
  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>kafka-auth</span>
    <span style=color:#f92672>secret</span>:
      <span style=color:#f92672>secretName</span>: <span style=color:#ae81ff>kafka-auth</span>
</code></pre></div><p>Apply the file with:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl apply -f kcat-connect.yaml
</code></pre></div><p>The Pod will execute the commands and finish. You can confirm its <code>Completed</code> state with:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl get pod kafka-message

NAME            READY   STATUS      RESTARTS   AGE
kafka-message   0/1     Completed   <span style=color:#ae81ff>0</span>          5m35s
</code></pre></div><p>If everything went smoothly, we should have our produced message in the PostgreSQL service. Let&rsquo;s check that out.</p>
<p>Create a file named <code>psql-connect.yaml</code> with the content below:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
<span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
<span style=color:#f92672>metadata</span>:
  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>psql-connect</span>
<span style=color:#f92672>spec</span>:
  <span style=color:#f92672>restartPolicy</span>: <span style=color:#ae81ff>Never</span>
  <span style=color:#f92672>containers</span>:
    - <span style=color:#f92672>image</span>: <span style=color:#ae81ff>postgres:13</span>
      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>postgres</span>
      <span style=color:#75715e># &#34;kafka-topic-connect&#34; is the table automatically created by KafkaConnect</span>
      <span style=color:#f92672>command</span>: [<span style=color:#e6db74>&#39;psql&#39;</span>, <span style=color:#e6db74>&#39;$(DATABASE_URI)&#39;</span>, <span style=color:#e6db74>&#39;-c&#39;</span>, <span style=color:#e6db74>&#39;SELECT * from &#34;kafka-topic-connect&#34;;&#39;</span>]
      
      <span style=color:#f92672>envFrom</span>:
      - <span style=color:#f92672>secretRef</span>:
          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>pg-connection</span>
</code></pre></div><p>Apply the file with:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl apply -f psql-connect.yaml
</code></pre></div><p>After a couple of seconds, inspects its log with the command below. The output should be as follows:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl logs psql-connect 

    text     
-------------
 Hello World
<span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> row<span style=color:#f92672>)</span>
</code></pre></div><h2 id=clean-up>Clean up</h2>
<p>To clean up all the created resources, use the command below:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ kubectl delete <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  -f kafka-sample-connect.yaml <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  -f kafka-connect.yaml <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  -f service-integration-connect.yaml <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  -f pg-sample-connect.yaml <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  -f kafka-connector-connect.yaml <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  -f kcat-connect.yaml <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  -f psql-connect.yaml
</code></pre></div>
<div class="text-muted mt-5 pt-3 border-top">
</div>
</div>
</main>
</div>
</div>
<footer class="bg-dark py-5 row d-print-none">
<div class="container-fluid mx-sm-5">
<div class=row>
<div class="col-6 col-sm-4 text-xs-center order-sm-2">
<ul class="list-inline mb-0">
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Aiven Website" aria-label="Aiven Website">
<a class=text-white target=_blank rel=noopener href=https://aiven.io aria-label="Aiven Website">
<i class="fa fa-globe"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter>
<a class=text-white target=_blank rel=noopener href=https://twitter.com/aiven_io aria-label=Twitter>
<i class="fab fa-twitter"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub>
<a class=text-white target=_blank rel=noopener href=https://github.com/aiven/aiven-operator aria-label=GitHub>
<i class="fab fa-github"></i>
</a>
</li>
</ul>
</div>
<div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
</div>
<div class="col-12 col-sm-4 text-center py-2 order-sm-2">
<small class=text-white>&copy; 2021 Aiven Team, All Rights Reserved</small>
</div>
</div>
</div>
</footer>
</div>
<script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script>
<script src=/aiven-operator/js/main.min.53c4d99c5ceabc0c35f44f5ccaa737b46d3fb78d8cfb31c9025e37db2ce7b376.js integrity="sha256-U8TZnFzqvAw19E9cyqc3tG0/t42M+zHJAl432yzns3Y=" crossorigin=anonymous></script>
</body>
</html>