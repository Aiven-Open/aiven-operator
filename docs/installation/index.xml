<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Aiven Operator â€“ Installation</title><link>https://aiven.github.io/aiven-operator/docs/installation/</link><description>Recent content in Installation on Aiven Operator</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><atom:link href="https://aiven.github.io/aiven-operator/docs/installation/index.xml" rel="self" type="application/rss+xml"/><item><title>Docs: Prerequisites</title><link>https://aiven.github.io/aiven-operator/docs/installation/prerequisites/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://aiven.github.io/aiven-operator/docs/installation/prerequisites/</guid><description>
&lt;p>The Aiven Operator for Kubernetes supports all major Kubernetes distributions, both locally and in the cloud.&lt;/p>
&lt;p>Make sure you have the following:&lt;/p>
&lt;ul>
&lt;li>To use the operator, you need admin access to a Kubernetes cluster.&lt;/li>
&lt;li>For playground usage you can use &lt;a href="https://kind.sigs.k8s.io/">kind&lt;/a> for example.&lt;/li>
&lt;li>For productive usage &lt;a href="https://helm.sh">Helm&lt;/a> is recommended.&lt;/li>
&lt;/ul>
&lt;h2 id="cert-managerhttpscert-managerio">&lt;a href="https://cert-manager.io/">Cert Manager&lt;/a>&lt;/h2>
&lt;p>The Aiven Operator for Kubernetes uses &lt;code>cert-manager&lt;/code> to configure the &lt;a href="https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/#service-reference">service reference&lt;/a> of our webhooks.&lt;/p>
&lt;p>Please follow the &lt;a href="https://cert-manager.io/docs/installation/helm/">installation instructions&lt;/a> on their website.&lt;/p>
&lt;blockquote>
&lt;p>Note: this is not required in the Helm installation if you select to &lt;a href="../helm/_index.md">disable webhooks&lt;/a>, but that is not recommended outside of playground use. The Aiven Operator for Kubernetes uses webhooks for setting defaults and enforcing invariants that are expected by the aiven API and will lead to errors if ignored. In the future webhooks will also be used for conversion and supporting multiple CRD versions.&lt;/p>
&lt;/blockquote></description></item><item><title>Docs: Installing with Helm (recommended)</title><link>https://aiven.github.io/aiven-operator/docs/installation/helm/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://aiven.github.io/aiven-operator/docs/installation/helm/</guid><description>
&lt;h2 id="installing">Installing&lt;/h2>
&lt;p>The Aiven Operator for Kubernetes can be installed via &lt;a href="https://helm.sh/">Helm&lt;/a>.&lt;/p>
&lt;p>First add the &lt;a href="https://github.com/aiven/aiven-charts">Aiven Helm repository&lt;/a>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ helm repo add aiven https://aiven.github.io/aiven-charts &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> helm repo update
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="installing-custom-resource-definitions">Installing Custom Resource Definitions&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ helm install aiven-operator-crds aiven/aiven-operator-crds
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Verify the installation:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ kubectl api-resources --api-group&lt;span style="color:#f92672">=&lt;/span>aiven.io
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>NAME SHORTNAMES APIVERSION NAMESPACED KIND
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>connectionpools aiven.io/v1alpha1 true ConnectionPool
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>databases aiven.io/v1alpha1 true Database
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>... &amp;lt; several omitted lines &amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="installing-the-operator">Installing the Operator&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ helm install aiven-operator aiven/aiven-operator
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>Note: Installation will fail if webhooks are enabled and the CRDs for the cert-manager are not installed.&lt;/p>
&lt;/blockquote>
&lt;p>Verify the installation:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ helm status aiven-operator
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>NAME: aiven-operator
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>LAST DEPLOYED: Fri Sep &lt;span style="color:#ae81ff">10&lt;/span> 15:23:26 &lt;span style="color:#ae81ff">2021&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>NAMESPACE: default
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>STATUS: deployed
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>REVISION: &lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>TEST SUITE: None
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>It is also possible to install the operator without webhooks enabled:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ helm install aiven-operator aiven/aiven-operator --set webhooks.enabled&lt;span style="color:#f92672">=&lt;/span>false
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="configuration-options">Configuration Options&lt;/h3>
&lt;p>Please refer to the &lt;a href="https://github.com/aiven/aiven-charts/blob/main/charts/aiven-operator/values.yaml">values.yaml&lt;/a> of the chart.&lt;/p>
&lt;h2 id="uninstalling">Uninstalling&lt;/h2>
&lt;p>Find out the name of your deployment:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ helm list
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>NAME NAMESPACE REVISION UPDATED STATUS CHART APP VERSION
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>aiven-operator default &lt;span style="color:#ae81ff">1&lt;/span> 2021-09-09 10:56:14.623700249 +0200 CEST deployed aiven-operator-v0.1.0 v0.1.0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>aiven-operator-crds default &lt;span style="color:#ae81ff">1&lt;/span> 2021-09-09 10:56:05.736411868 +0200 CEST deployed aiven-operator-crds-v0.1.0 v0.1.0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Remove the CRDs:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ helm uninstall aiven-operator-crds
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>release &lt;span style="color:#e6db74">&amp;#34;aiven-operator-crds&amp;#34;&lt;/span> uninstalled
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Remove the operator:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ helm uninstall aiven-operator
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>release &lt;span style="color:#e6db74">&amp;#34;aiven-operator&amp;#34;&lt;/span> uninstalled
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Docs: Installing with kubectl</title><link>https://aiven.github.io/aiven-operator/docs/installation/kubectl/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://aiven.github.io/aiven-operator/docs/installation/kubectl/</guid><description>
&lt;h2 id="installing">Installing&lt;/h2>
&lt;p>All Aiven Operator for Kubernetes components can be installed from one YAML file that is uploaded for every release:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ kubectl apply -f https://github.com/aiven/aiven-operator/releases/latest/download/deployment.yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>By default the Deployment is installed into the &lt;code>aiven-operator-system&lt;/code> namespace.&lt;/p>
&lt;h2 id="uninstalling">Uninstalling&lt;/h2>
&lt;p>Assuming you installed version &lt;code>vX.Y.Z&lt;/code> of the operator it can be uninstalled via&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ kubectl delete -f https://github.com/aiven/aiven-operator/releases/download/vX.Y.Z/deployment.yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Docs: Uninstalling</title><link>https://aiven.github.io/aiven-operator/docs/installation/uninstalling/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://aiven.github.io/aiven-operator/docs/installation/uninstalling/</guid><description>
&lt;h2 id="-warning-">ðŸš¨ Warning ðŸš¨&lt;/h2>
&lt;p>Uninstalling the Aiven Operator for Kubernetes can remove the resources created in Aiven, possibly resulting in data loss.&lt;/p>
&lt;p>Depending on your installation, please follow one of:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://aiven.github.io/aiven-operator/aiven-operator/docs/installation/helm/#uninstalling">Helm&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://aiven.github.io/aiven-operator/aiven-operator/docs/installation/kubectl/#uninstalling">kubectl&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="dealing-with-expired-tokens">Dealing with expired tokens&lt;/h2>
&lt;p>Aiven resources need to have an accompanying secret that contains the token that is used to authorize the manipulation of that resource.
If that token expired then you will not be able to delete the custom resource and deletion will also hang until the situation is resolved.
The recommended approach to deal with that situation is to patch a valid token into the secret again so that proper cleanup of aiven resources can take place.&lt;/p>
&lt;h2 id="hanging-deletions">Hanging deletions&lt;/h2>
&lt;p>To protect the secrets that the operator is using from deletion, it adds the &lt;a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/finalizers/">finalizer&lt;/a> &lt;code>finalizers.aiven.io/needed-to-delete-services&lt;/code> to the secret.
This solves a race condition that happens when deleting a namespace, where there is a possibility of the secret getting deleted before the resource that uses it.
When the controller is deleted it may not cleanup the finalizers from all secrets.
If there is a secret with this finalizer blocking deletion of a namespace, for now please do&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>kubectl patch secret &amp;lt;offending-secret&amp;gt; -p &lt;span style="color:#e6db74">&amp;#39;{&amp;#34;metadata&amp;#34;:{&amp;#34;finalizers&amp;#34;:null}}&amp;#39;&lt;/span> --type&lt;span style="color:#f92672">=&lt;/span>merge
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>to remove the finalizer.&lt;/p></description></item></channel></rss>